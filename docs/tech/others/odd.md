# 一些奇怪的知识合集

#### 1. 为什么文件系统中文件大小和占用空间不同？

之前只知道可能占用空间会变大，但最近拷数据时还有占用空间小于文件大小的情况

+ 占用空间 > 文件大小: 这是十分常见的情况，由于操作系统按照簇的方式给文件分配大小(cluster > block > sector)，所以当一个文件的大小小于一个簇的大小时，所分配的占用空间是大于文件实际大小的
  
+ 占用空间 < 文件大小: 这个和稀疏文件有关(Sparse File)，稀疏文件指的是文件中出现大量的0数据，特定的操作系统会采用算法将这些0数据压缩，从而达到节省空间的目的，那么文件所声明的文件大小就会大于所占用的空间。


#### 2. PCIE插槽及其规范

先放一张PCIE各版本规格图，通常我们所说的PCIE x16,x8等，都指的是PCI-E通道数，通道数越多带宽越高。
<img src="../assets/imagePCIE.png" style="zoom:100%;" />

PCI-E插槽有x1，x2，x4，x8，x12，x16和x32共计7种版本，对应1/2/4/8/12/16/32通道。其中PCI-E x32由于体积原因仅使用在特殊场合，PCI-E x12主要用在服务器领域，PCI-E x2则主要用于内部的接口而非扩展插槽。通常能见到的集中在PCI-E x1/x4/x8/x16四种。

PCI-E x16和x8通常都以x16的插槽展现，只是x8的数据针脚只有一半是有效的，这种插槽也是主板上最常见的

PCI-E x4同样是在PCI-E x16插槽的基础上，以减少数据针脚的方式实现，主要用于PCI-E SSD，或者是通过PCI-E转接卡安装M.2 SSD等方面，所以通常看到的是M.2接口

PCI-E x1插槽数据针脚最少，面向的产品比较广泛，独立网卡、独立声卡、USB 3.0/3.1扩展卡等都会用到PCI-E x1插槽。另外一种形态是Mini PCI-E接口，常见于Mini-ITX主板以及笔记本电脑上，多数用来扩展无线网卡，目前地位和作用被M.2接口所取代。

#### 3. BT原理分享(转)

[BT原理分享](https://www.cnblogs.com/EasonJim/p/6601146.html)

**Bittorrent协议**

BT全名为BitTorrent,是一个p2p软件,你在下载download的同时，也在为其他用户提供上传upload，因为大家是“互相帮助”，所以不会随着用户数的增加而降低下载速度。

比起其它的P2P软件，BT有个独特的地方，它存在一个中间的WEB服务器，就是我们在发布的时所填写的announce。 该服务器提供了发布的统一管理，不像其它P2P软件那样到处去找哪些非常不稳定的个人服务器，相对起来让人安心的多。

BT服务器是通过一种类似传销的方式来实现文件共享的。举个例子来说吧，例如BT服务器将一个文件分成了N个部分，有甲、乙、丙、丁四位用户同时下载，那么BT并不会完全从服务器下载这个文件的所有部分，而是根据实际情况有选择地从其他用户的机器中下载已下载完成的部分。例如甲已经下载了第1部分，乙已经下载了第2部分，那么丙就会从甲的机器中下载第1部分，从乙的机器中下载第2部分，当然甲、乙、丁三位用户也在同时从丙的机器中下载相应的部分，这就大大减轻了BT服务器的负荷，也同时加快了丙的下载速度，也就是说每台参加下载的计算机既从其他用户的计算机上下载文件，同时自身也向其他用户提供下载，因此参与下载的用户数量越多，下载速度也越高。

**.torrent 的作用**

大家都知道我们要用BT下载 ，就要先下载一个.torrent文件，这个文件到底是什么呢：

首先是 announce 纪录了发布服务器的位置，让BT知道是那个WEB服务器发布的，然后是一些文件信息，文件名，目录名，长度等等，最后是片段长度，和片段的 Sha1 校验码，（BT为了事现续传和文件校验，就把文件分成若干个片段），大家可以打开torrent文件看看，就是知道个大概，后面的乱码是片段 Sha1 校验码。

BT 打开一个 torrent文件后，先要你选择文件保存那里。然后判断文件不存在的话就建立新文件，存在的话就用 Sha1 校验码去校验文件---错误的就是还没下载的，这样就可以实现续传了，但128位校验，想不慢都不行

**服务器会做什么**

服务器中有个一个 track 程序来管理这些请求，得到这一串代码后就会用 info_hash 来查找列表，找到你就可以下载，找不到就对不起啦。接着它会反连（NatCheck）你的 IP 和 Port这样就可以知道你是内网用户还是共网用户（如果你是内网用户，它是连不通的，因为它会连到你的服务器上，你的服务器当然没有这个端口啦），然后服务器返回现在正在下载这个文件的所有公网用户的IP和port，就像是：d8:intervali1800e5eersld2:ip14:xxx.xxx.xx.xxx7eerid20:00180531904b7e3abdd74orti6881eeee

interval 1800 是告诉 BT 隔多少秒来查询一次这里是 30 分钟 （有点过分了），最后如果你是公网用户它会把你提交的 IP 和 Port 放到info_hash 对应的列表中，这样其它人就可以找到你

得到这些 peer IP后，BT就可以找到对应的IP下载了，BT会到所有的peer去寻找自己要下载的东西，不是一定要到seed下载。BT每找到一个peer就和建立一个Socket来下载，所以下载的人越多，速度就越快。

**内网用户可以做Send的原理**

上面说到服务器只会返回公网的ip的，那内网用户怎么可以做Send呢，这是因为BT是一个主动连接的软件（即使你已经下载完了，也不也会主动连接他人）下面是一个仿真流程：

1 内网用户开始做 seed，

2 服务器收到请求，由于是第一个所以也没有peer返回

3 公网用户提交请求，由于seed是内网用户所以也没有peer返回，等待下载，但服务器会把它的IP放到列表中

4 内网经过 interval 时间间隔后，再向服务器放出请求，得到上面得公网IP

5 得到公网IP后，内网马上进行连接

6 公网用户建立连接，数据开始传输 （注意现在是公网用户做服务器，内网用户做客户端，是不是有点怪）

7 其它内网用户去上面公网用户下载数据

所以，内网用户做 seed 一定要有公网用户得参与，否则其它内网用户无法下载。如果全部是内网用户，那个所有连接都不会成立，当然这是比较极端的情况。

以上可见，内网用户不能和内网用户连接，其它用户无法从服务器查到你，所以无法主动连接你，你只能每隔30分钟从服务器找到公网用户一个个进行连接。